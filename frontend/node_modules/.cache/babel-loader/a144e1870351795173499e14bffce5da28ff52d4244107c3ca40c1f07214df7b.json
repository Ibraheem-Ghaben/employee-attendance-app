{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[isLoading,setIsLoading]=useState(true);// Check for existing session on mount\nuseEffect(()=>{const storedToken=localStorage.getItem('token');const storedUser=localStorage.getItem('user');if(storedToken&&storedUser){setToken(storedToken);setUser(JSON.parse(storedUser));}setIsLoading(false);},[]);const login=async(username,password)=>{try{const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/auth/login\"),{username,password});if(response.data.success){const{user:userData,token:userToken}=response.data;setUser(userData);setToken(userToken);localStorage.setItem('token',userToken);localStorage.setItem('user',JSON.stringify(userData));}else{throw new Error(response.data.message||'Login failed');}}catch(error){var _error$response,_error$response$data;console.error('Login error:',error);throw new Error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Login failed');}};const logout=()=>{setUser(null);setToken(null);localStorage.removeItem('token');localStorage.removeItem('user');};const value={user,token,login,logout,isAuthenticated:!!token&&!!user,isLoading};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsx","_jsx","AuthContext","undefined","AuthProvider","_ref","children","user","setUser","token","setToken","isLoading","setIsLoading","storedToken","localStorage","getItem","storedUser","JSON","parse","login","username","password","response","post","concat","process","env","REACT_APP_API_URL","data","success","userData","userToken","setItem","stringify","Error","message","error","_error$response","_error$response$data","console","logout","removeItem","value","isAuthenticated","Provider","useAuth","context"],"sources":["/home/administrator/employee_attendance_app/frontend/src/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect, ReactNode } from 'react';\nimport axios from 'axios';\n\ninterface User {\n  id: number;\n  username: string;\n  employee_code?: string;\n  role: 'admin' | 'supervisor' | 'employee';\n  full_name: string;\n  email?: string;\n  is_active: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  token: string | null;\n  login: (username: string, password: string) => Promise<void>;\n  logout: () => void;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [token, setToken] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check for existing session on mount\n  useEffect(() => {\n    const storedToken = localStorage.getItem('token');\n    const storedUser = localStorage.getItem('user');\n    \n    if (storedToken && storedUser) {\n      setToken(storedToken);\n      setUser(JSON.parse(storedUser));\n    }\n    setIsLoading(false);\n  }, []);\n\n  const login = async (username: string, password: string) => {\n    try {\n      const response = await axios.post(\n        `${process.env.REACT_APP_API_URL}/auth/login`,\n        { username, password }\n      );\n\n      if (response.data.success) {\n        const { user: userData, token: userToken } = response.data;\n        \n        setUser(userData);\n        setToken(userToken);\n        \n        localStorage.setItem('token', userToken);\n        localStorage.setItem('user', JSON.stringify(userData));\n      } else {\n        throw new Error(response.data.message || 'Login failed');\n      }\n    } catch (error: any) {\n      console.error('Login error:', error);\n      throw new Error(error.response?.data?.message || 'Login failed');\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n  };\n\n  const value = {\n    user,\n    token,\n    login,\n    logout,\n    isAuthenticated: !!token && !!user,\n    isLoading,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,KAAmB,OAAO,CACxF,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAqB1B,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAA8BQ,SAAS,CAAC,CAEzE,MAAO,MAAM,CAAAC,YAA+C,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAC1E,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGZ,QAAQ,CAAc,IAAI,CAAC,CACnD,KAAM,CAACa,KAAK,CAAEC,QAAQ,CAAC,CAAGd,QAAQ,CAAgB,IAAI,CAAC,CACvD,KAAM,CAACe,SAAS,CAAEC,YAAY,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAEhD;AACAE,SAAS,CAAC,IAAM,CACd,KAAM,CAAAe,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CACjD,KAAM,CAAAC,UAAU,CAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAE/C,GAAIF,WAAW,EAAIG,UAAU,CAAE,CAC7BN,QAAQ,CAACG,WAAW,CAAC,CACrBL,OAAO,CAACS,IAAI,CAACC,KAAK,CAACF,UAAU,CAAC,CAAC,CACjC,CACAJ,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAO,KAAK,CAAG,KAAAA,CAAOC,QAAgB,CAAEC,QAAgB,GAAK,CAC1D,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAvB,KAAK,CAACwB,IAAI,IAAAC,MAAA,CAC5BC,OAAO,CAACC,GAAG,CAACC,iBAAiB,gBAChC,CAAEP,QAAQ,CAAEC,QAAS,CACvB,CAAC,CAED,GAAIC,QAAQ,CAACM,IAAI,CAACC,OAAO,CAAE,CACzB,KAAM,CAAEtB,IAAI,CAAEuB,QAAQ,CAAErB,KAAK,CAAEsB,SAAU,CAAC,CAAGT,QAAQ,CAACM,IAAI,CAE1DpB,OAAO,CAACsB,QAAQ,CAAC,CACjBpB,QAAQ,CAACqB,SAAS,CAAC,CAEnBjB,YAAY,CAACkB,OAAO,CAAC,OAAO,CAAED,SAAS,CAAC,CACxCjB,YAAY,CAACkB,OAAO,CAAC,MAAM,CAAEf,IAAI,CAACgB,SAAS,CAACH,QAAQ,CAAC,CAAC,CACxD,CAAC,IAAM,CACL,KAAM,IAAI,CAAAI,KAAK,CAACZ,QAAQ,CAACM,IAAI,CAACO,OAAO,EAAI,cAAc,CAAC,CAC1D,CACF,CAAE,MAAOC,KAAU,CAAE,KAAAC,eAAA,CAAAC,oBAAA,CACnBC,OAAO,CAACH,KAAK,CAAC,cAAc,CAAEA,KAAK,CAAC,CACpC,KAAM,IAAI,CAAAF,KAAK,CAAC,EAAAG,eAAA,CAAAD,KAAK,CAACd,QAAQ,UAAAe,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBT,IAAI,UAAAU,oBAAA,iBAApBA,oBAAA,CAAsBH,OAAO,GAAI,cAAc,CAAC,CAClE,CACF,CAAC,CAED,KAAM,CAAAK,MAAM,CAAGA,CAAA,GAAM,CACnBhC,OAAO,CAAC,IAAI,CAAC,CACbE,QAAQ,CAAC,IAAI,CAAC,CACdI,YAAY,CAAC2B,UAAU,CAAC,OAAO,CAAC,CAChC3B,YAAY,CAAC2B,UAAU,CAAC,MAAM,CAAC,CACjC,CAAC,CAED,KAAM,CAAAC,KAAK,CAAG,CACZnC,IAAI,CACJE,KAAK,CACLU,KAAK,CACLqB,MAAM,CACNG,eAAe,CAAE,CAAC,CAAClC,KAAK,EAAI,CAAC,CAACF,IAAI,CAClCI,SACF,CAAC,CAED,mBAAOV,IAAA,CAACC,WAAW,CAAC0C,QAAQ,EAACF,KAAK,CAAEA,KAAM,CAAApC,QAAA,CAAEA,QAAQ,CAAuB,CAAC,CAC9E,CAAC,CAED,MAAO,MAAM,CAAAuC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAAC,OAAO,CAAGjD,UAAU,CAACK,WAAW,CAAC,CACvC,GAAI4C,OAAO,GAAK3C,SAAS,CAAE,CACzB,KAAM,IAAI,CAAA+B,KAAK,CAAC,6CAA6C,CAAC,CAChE,CACA,MAAO,CAAAY,OAAO,CAChB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}